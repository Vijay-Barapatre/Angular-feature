<!-- ngOnInit & ngOnDestroy -->

<div class="use-case-container fade-in">
    <!-- Header -->
    <div class="page-header">
        <a routerLink="/lifecycle-hooks" class="back-link">â† Back to Lifecycle Hooks</a>
        <h1>ğŸš€ ngOnInit & ngOnDestroy</h1>
        <p class="header-description">
            Learn how to properly initialize components and clean up resources.
            Toggle the timer to see ngOnInit and ngOnDestroy in action.
        </p>
    </div>

    <!-- Main Content -->
    <div class="content-grid">
        <!-- Left: Interactive Demo -->
        <div class="demo-section">
            <h2>ğŸ® Interactive Demo</h2>

            <div class="demo-card">
                <div class="controls">
                    <button class="btn btn-primary" (click)="toggleTimer()">
                        {{ showTimer ? 'ğŸ’€ Destroy Timer' : 'ğŸš€ Create Timer' }}
                    </button>
                    <button class="btn btn-secondary" (click)="clearLog()">
                        ğŸ—‘ï¸ Clear Log
                    </button>
                </div>

                <div class="timer-container">
                    <!-- Timer Component - conditionally rendered -->
                    <app-timer *ngIf="showTimer" (lifecycleEvent)="onLifecycleEvent($event)">
                    </app-timer>

                    <!-- Placeholder when timer is destroyed -->
                    <div *ngIf="!showTimer" class="timer-placeholder">
                        <span class="placeholder-icon">ğŸ’€</span>
                        <p>Timer component destroyed</p>
                        <p class="hint">Click "Create Timer" to initialize a new instance</p>
                    </div>
                </div>
            </div>

            <!-- Lifecycle Log -->
            <div class="log-section">
                <h3>ğŸ“‹ Lifecycle Event Log</h3>
                <div class="log-container">
                    <div *ngIf="lifecycleLog.length === 0" class="log-empty">
                        No events yet. Toggle the timer to see lifecycle events.
                    </div>
                    <div *ngFor="let log of lifecycleLog" class="log-entry" [class]="'log-' + log.type">
                        <span class="log-time">{{ log.time }}</span>
                        <span class="log-event">{{ log.event }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right: Code Explanation -->
        <div class="explanation-section">
            <h2>ğŸ“– How It Works</h2>

            <!-- ngOnInit Explanation -->
            <div class="concept-card">
                <h3>ğŸš€ ngOnInit</h3>
                <p class="concept-description">
                    Called <strong>once</strong> after Angular first displays the data-bound properties
                    and sets the component's input properties. Use it for initialization logic.
                </p>
                <div class="code-block">
                    <pre><code>export class TimerComponent implements OnInit &#123;
  ngOnInit(): void &#123;
    // âœ… Start subscriptions
    // âœ… Fetch initial data
    // âœ… Set up timers
    this.startTimer();
  &#125;
&#125;</code></pre>
                </div>
                <div class="best-practices">
                    <h4>âœ… Best Practices:</h4>
                    <ul>
                        <li>Fetch data from APIs here, not in constructor</li>
                        <li>Initialize subscriptions to observables</li>
                        <li>Set up intervals/timers</li>
                        <li>Access &#64;Input values (they're set by now)</li>
                    </ul>
                </div>
            </div>

            <!-- ngOnDestroy Explanation -->
            <div class="concept-card">
                <h3>ğŸ’€ ngOnDestroy</h3>
                <p class="concept-description">
                    Called <strong>just before</strong> Angular destroys the component.
                    Use it for cleanup to prevent memory leaks.
                </p>
                <div class="code-block">
                    <pre><code>export class TimerComponent implements OnDestroy &#123;
  private subscription: Subscription;

  ngOnDestroy(): void &#123;
    // âœ… Unsubscribe from observables
    this.subscription.unsubscribe();
    // âœ… Clear timers/intervals
    clearInterval(this.timerId);
    // âœ… Remove event listeners
    this.cleanup();
  &#125;
&#125;</code></pre>
                </div>
                <div class="best-practices warning">
                    <h4>âš ï¸ Memory Leak Prevention:</h4>
                    <ul>
                        <li>Always unsubscribe from observables</li>
                        <li>Clear setInterval/setTimeout</li>
                        <li>Remove DOM event listeners</li>
                        <li>Disconnect WebSocket connections</li>
                    </ul>
                </div>
            </div>

            <!-- Lifecycle Order -->
            <div class="concept-card highlight">
                <h3>ğŸ“Š Execution Order</h3>
                <div class="order-diagram">
                    <div class="order-step">
                        <span class="step-num">1</span>
                        <span class="step-name">constructor</span>
                    </div>
                    <div class="order-arrow">â†“</div>
                    <div class="order-step">
                        <span class="step-num">2</span>
                        <span class="step-name">ngOnChanges</span>
                        <span class="step-note">(if inputs exist)</span>
                    </div>
                    <div class="order-arrow">â†“</div>
                    <div class="order-step active">
                        <span class="step-num">3</span>
                        <span class="step-name">ngOnInit</span>
                        <span class="step-note">â­ Called once!</span>
                    </div>
                    <div class="order-arrow">â†“</div>
                    <div class="order-step">
                        <span class="step-num">...</span>
                        <span class="step-name">Component lives</span>
                    </div>
                    <div class="order-arrow">â†“</div>
                    <div class="order-step destroy">
                        <span class="step-num">9</span>
                        <span class="step-name">ngOnDestroy</span>
                        <span class="step-note">ğŸ’€ Cleanup time!</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
