<!-- View Lifecycle Hooks -->

<div class="use-case-container fade-in">
    <!-- Header -->
    <div class="page-header">
        <a routerLink="/lifecycle-hooks" class="back-link">â† Back to Lifecycle Hooks</a>
        <h1>ğŸ‘ï¸ View Lifecycle Hooks</h1>
        <p class="header-description">
            Learn ngAfterViewInit and ngAfterViewChecked for accessing child components and DOM elements.
            Essential for integrating third-party libraries.
        </p>
    </div>

    <!-- Main Content -->
    <div class="content-grid">
        <!-- Left: Interactive Demo -->
        <div class="demo-section">
            <h2>ğŸ® Interactive Demo</h2>

            <!-- Controls -->
            <div class="controls-card">
                <div class="controls">
                    <button class="btn btn-primary" (click)="toggleChart()">
                        {{ showChart ? 'ğŸš« Hide Chart' : 'ğŸ“Š Show Chart' }}
                    </button>
                    <button class="btn btn-secondary" (click)="randomizeData()" [disabled]="!showChart">
                        ğŸ² Randomize Data
                    </button>
                    <button class="btn btn-secondary" (click)="addDataPoint()" [disabled]="!showChart">
                        â• Add Point
                    </button>
                    <button class="btn btn-outline" (click)="clearLog()">
                        ğŸ—‘ï¸ Clear Log
                    </button>
                </div>
            </div>

            <!-- Chart Component -->
            <div class="chart-container">
                <h3>ğŸ“Š Chart Component (Uses &#64;ViewChild)</h3>

                <app-chart *ngIf="showChart" [data]="chartData" (viewLifecycleEvent)="onViewLifecycleEvent($event)">
                </app-chart>

                <div *ngIf="!showChart" class="chart-placeholder">
                    <span class="placeholder-icon">ğŸ“Š</span>
                    <p>Chart component destroyed</p>
                    <p class="hint">Click "Show Chart" to see ngAfterViewInit in action</p>
                </div>
            </div>

            <!-- View Lifecycle Log -->
            <div class="log-section">
                <h3>ğŸ“‹ View Lifecycle Log</h3>
                <div class="log-container">
                    <div *ngIf="viewLifecycleLog.length === 0" class="log-empty">
                        No events yet. Show the chart or update data.
                    </div>
                    <div *ngFor="let log of viewLifecycleLog" class="log-entry" [class]="'log-' + log.type">
                        <span class="log-time">{{ log.time }}</span>
                        <span class="log-event">{{ log.event }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right: Code Explanation -->
        <div class="explanation-section">
            <h2>ğŸ“– How It Works</h2>

            <!-- ngAfterViewInit Explanation -->
            <div class="concept-card">
                <h3>ğŸ‘ï¸ ngAfterViewInit</h3>
                <p class="concept-description">
                    Called <strong>once</strong> after Angular initializes the component's views
                    and child views. This is the safe place to access &#64;ViewChild elements.
                </p>
                <div class="code-block">
                    <pre><code>export class ChartComponent implements AfterViewInit &#123;
  &#64;ViewChild('chartCanvas') 
  canvasRef!: ElementRef&lt;HTMLCanvasElement&gt;;

  ngAfterViewInit(): void &#123;
    // âœ… Safe to access &#64;ViewChild here!
    const canvas = this.canvasRef.nativeElement;
    this.initChart(canvas);
  &#125;
&#125;</code></pre>
                </div>
                <div class="best-practices">
                    <h4>âœ… Use Cases:</h4>
                    <ul>
                        <li>Initialize third-party libraries (charts, maps)</li>
                        <li>Access &#64;ViewChild elements</li>
                        <li>Measure DOM elements</li>
                        <li>Set up DOM event listeners</li>
                    </ul>
                </div>
            </div>

            <!-- ngAfterViewChecked Explanation -->
            <div class="concept-card warning-card">
                <h3>ğŸ”„ ngAfterViewChecked</h3>
                <p class="concept-description">
                    Called <strong>after every</strong> change detection run that checks the
                    component's views. Use with caution - runs frequently!
                </p>
                <div class="code-block">
                    <pre><code>ngAfterViewChecked(): void &#123;
  // âš ï¸ Called VERY frequently!
  // Keep logic minimal
  if (this.needsUpdate) &#123;
    this.updateChart();
    this.needsUpdate = false;
  &#125;
&#125;</code></pre>
                </div>
                <div class="best-practices warning">
                    <h4>âš ï¸ Performance Warning:</h4>
                    <ul>
                        <li>Called on EVERY change detection cycle</li>
                        <li>Avoid expensive operations</li>
                        <li>Use flags to prevent redundant work</li>
                        <li>Don't modify component state (causes infinite loop!)</li>
                    </ul>
                </div>
            </div>

            <!-- Lifecycle Order -->
            <div class="concept-card highlight">
                <h3>ğŸ“Š View Lifecycle Order</h3>
                <div class="order-diagram">
                    <div class="order-step">
                        <span class="step-num">1</span>
                        <span class="step-name">ngOnInit</span>
                    </div>
                    <div class="order-arrow">â†“</div>
                    <div class="order-step">
                        <span class="step-num">2</span>
                        <span class="step-name">ngAfterContentInit</span>
                        <span class="step-note">Content ready</span>
                    </div>
                    <div class="order-arrow">â†“</div>
                    <div class="order-step active">
                        <span class="step-num">3</span>
                        <span class="step-name">ngAfterViewInit</span>
                        <span class="step-note">â­ View ready!</span>
                    </div>
                    <div class="order-arrow">â†“</div>
                    <div class="order-step checked">
                        <span class="step-num">4</span>
                        <span class="step-name">ngAfterViewChecked</span>
                        <span class="step-note">ğŸ”„ Repeats</span>
                    </div>
                </div>
            </div>

            <!-- Common Pitfall -->
            <div class="concept-card error-card">
                <h3>âŒ Common Pitfall</h3>
                <p class="concept-description">
                    Accessing &#64;ViewChild in ngOnInit will give you undefined!
                </p>
                <div class="code-block">
                    <pre><code>// âŒ WRONG - ViewChild not ready yet!
ngOnInit(): void &#123;
  console.log(this.canvasRef); // undefined!
&#125;

// âœ… CORRECT - ViewChild is ready
ngAfterViewInit(): void &#123;
  console.log(this.canvasRef); // ElementRef
&#125;</code></pre>
                </div>
            </div>
        </div>
    </div>
</div>
