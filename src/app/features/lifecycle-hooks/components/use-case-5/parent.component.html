<!-- USE CASE 5: ngDoCheck - Custom Change Detection -->

<div class="use-case-container fade-in">
    <!-- Header -->
    <div class="page-header">
        <a routerLink="/lifecycle-hooks" class="back-link">â† Back to Lifecycle Hooks</a>
        <h1>ğŸ” Use Case 5: ngDoCheck</h1>
        <p class="header-description">
            Learn custom change detection with ngDoCheck. Detect object mutations
            that Angular's default change detection misses.
        </p>
    </div>

    <!-- Main Content -->
    <div class="content-grid">
        <!-- Left: Interactive Demo -->
        <div class="demo-section">
            <h2>ğŸ® Interactive Demo</h2>

            <!-- Controls -->
            <div class="controls-card">
                <h3>ğŸ”§ Modify User Object</h3>
                <div class="controls">
                    <button class="btn btn-warning" (click)="mutateUser()">
                        âš ï¸ Mutate Name (same ref)
                    </button>
                    <button class="btn btn-success" (click)="replaceUser()">
                        âœ… Replace Object (new ref)
                    </button>
                    <button class="btn btn-warning" (click)="mutatePreferences()">
                        âš ï¸ Mutate Nested Prop
                    </button>
                    <button class="btn btn-outline" (click)="clearLog()">
                        ğŸ—‘ï¸ Clear Log
                    </button>
                </div>
                <p class="controls-hint">
                    âš ï¸ Mutations keep the same object reference - Angular's default CD won't detect them!
                </p>
            </div>

            <!-- Object Diff Component -->
            <div class="component-display">
                <h3>ğŸ” Object Diff Component (uses ngDoCheck)</h3>
                <app-object-diff [data]="user" (doCheckEvent)="onDoCheckEvent($event)">
                </app-object-diff>
            </div>

            <!-- DoCheck Log -->
            <div class="log-section">
                <h3>ğŸ“‹ ngDoCheck Log</h3>
                <div class="log-container">
                    <div *ngIf="doCheckLog.length === 0" class="log-empty">
                        No events yet. Try mutating or replacing the object.
                    </div>
                    <div *ngFor="let log of doCheckLog" class="log-entry" [class.detected]="log.detected"
                        [class.not-detected]="!log.detected">
                        <span class="log-time">{{ log.time }}</span>
                        <span class="log-event">{{ log.event }}</span>
                        <span class="log-status">{{ log.detected ? 'ğŸ”” Detected!' : 'ğŸ‘€ Checking' }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right: Code Explanation -->
        <div class="explanation-section">
            <h2>ğŸ“– How It Works</h2>

            <!-- ngDoCheck Explanation -->
            <div class="concept-card warning-card">
                <h3>ğŸ” ngDoCheck</h3>
                <p class="concept-description">
                    Called during <strong>every</strong> change detection run. Lets you implement
                    custom change detection for changes Angular doesn't detect.
                </p>
                <div class="code-block">
                    <pre><code>export class ObjectDiffComponent implements DoCheck &#123;
  &#64;Input() data: any;
  private previousData: string;

  ngDoCheck(): void &#123;
    // Custom comparison (deep equality)
    const current = JSON.stringify(this.data);
    if (current !== this.previousData) &#123;
      console.log('Change detected!');
      this.previousData = current;
    &#125;
  &#125;
&#125;</code></pre>
                </div>
            </div>

            <!-- When to Use -->
            <div class="concept-card">
                <h3>âœ… When to Use ngDoCheck</h3>
                <ul class="use-cases-list">
                    <li>
                        <span class="use-case-icon">ğŸ”„</span>
                        <span>Detecting object/array mutations</span>
                    </li>
                    <li>
                        <span class="use-case-icon">ğŸ”</span>
                        <span>Deep comparison of complex objects</span>
                    </li>
                    <li>
                        <span class="use-case-icon">ğŸ“Š</span>
                        <span>Syncing with non-Angular state</span>
                    </li>
                    <li>
                        <span class="use-case-icon">ğŸ¨</span>
                        <span>Third-party library integration</span>
                    </li>
                </ul>
            </div>

            <!-- Performance Warning -->
            <div class="concept-card error-card">
                <h3>âš ï¸ Performance Warning</h3>
                <p class="concept-description">
                    ngDoCheck runs on <strong>EVERY</strong> change detection cycle.
                    This can be hundreds of times per second!
                </p>
                <div class="warning-box">
                    <h4>ğŸš« DON'T:</h4>
                    <ul>
                        <li>Perform expensive operations</li>
                        <li>Make HTTP calls</li>
                        <li>Deep copy large objects</li>
                        <li>Trigger additional change detection</li>
                    </ul>
                </div>
                <div class="success-box">
                    <h4>âœ… DO:</h4>
                    <ul>
                        <li>Use simple comparisons</li>
                        <li>Cache previous values efficiently</li>
                        <li>Consider KeyValueDiffers/IterableDiffers</li>
                        <li>Use immutable data patterns instead</li>
                    </ul>
                </div>
            </div>

            <!-- Better Alternative -->
            <div class="concept-card highlight">
                <h3>ğŸ’¡ Better Alternative: Immutable Data</h3>
                <div class="code-block">
                    <pre><code>// âŒ Mutation (ngDoCheck needed)
this.user.name = 'New Name';

// âœ… Replacement (ngOnChanges works!)
this.user = &#123; ...this.user, name: 'New Name' &#125;;</code></pre>
                </div>
                <p class="concept-description">
                    Creating new object references lets Angular's default change
                    detection work, avoiding the need for ngDoCheck.
                </p>
            </div>
        </div>
    </div>
</div>
